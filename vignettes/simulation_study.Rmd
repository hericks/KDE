---
title: "simulation study"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{simulation_study}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
In this simulation study we essentially compare the three bandwidth estimation functions *cross_validation*, *goldenshluger_lepski* and *pco_method* from the package *KDE*. (kurz zum comparison mehr ? kurze Ã¼bersicht?)

## performance of various kernels 

In this section we want to investigate the influence of the kernel on the KDE function with an increasing number of samples. 
In order to have a good balance of denseties for studying the behaviour of the KDE, we first initialize a custom density as a *Density* S3-object, from which we want to sample from, along with other built-in densities.

```{r}
library(KDE)
# custom density: constructing a Density object
f_dens <- function(x) {
  ret <- 1 + sin(2*pi*x)
  ret[x < 0 | 1 < x] <- 0
  ret
}
support_density <- c(0,1)
dens <- Density(f_dens, support_density, subdivisions=1000L)

# plotting the density
x_lim <- c(dens$support[1] - 0.5, dens$support[2] + 0.5)
grid <- seq(from=x_lim[1], to=x_lim[2], length.out=300)
```
```{r, echo=FALSE, out.width='100%', fig.width=8, fig.height=4, fig.align = "center"}
plot(grid, dens$fun(grid), xlim = x_lim, ylim=c(-1,2),
     xlab = "",
     ylab = "",
     col = "dark red",
     type = "l",
     lwd = 2)
```
```{r}

#setting up a sampler for the density
g_den <- Density(dunif, c(0,1))
custom_sampler <- rejection_sampling(dens, g_den, runif, 2)
```

In the following two sections we first carry out a visual and then a numerical comparison of the KDE with different kernels, different number of samples and as an estimation of three different density functions.

### visual comparison 

We choose the three different kernels *rectangular*, *gaussian* and *epanechnikov* and initialize below the list *dens_list* with the three different densities we like to sample from along with their sampler functions.
Problem: Plots auseinanderzeihen!
```{r}
kernels <- list(rectangular = rectangular, gaussian = gaussian, epanechnikov = epanechnikov)
dens_list <- list(list(dens, custom_sampler), list(Density(dunif, c(0,1)), runif), list(Density(dnorm, c(-15,15)), rnorm))
n_samples <- c(10, 50, 1000)
bandwidth <- 0.1
par(mfrow = c(1, 3))
for(j in seq_along(dens_list)) {
  d <- dens_list[[j]]
    for (i in seq_along(kernels)) {
      for(n in n_samples) {
      samples <- d[[2]](n)
      name <- names(kernels)[[i]]
      k <- kernels[[i]]
        kde <- kernel_density_estimator(k, samples, bandwidth = bandwidth)
        if(j < 3){
          grid <- seq(from=x_lim[1], to=x_lim[2], length.out=300)
          plot(
            grid,
            d[[1]]$fun(grid),
            xlim = x_lim,
            ylim = c(-0.5, 2),
            main = paste(length(samples), "samples"),
            xlab = "",
            ylab = "",
            col = "dark red",
            type = "l",
            lwd = 2
          )
        }
        else{
          plot(
            grid <- seq(from = -16 ,to = 16, length.out=3000),
            d[[1]]$fun(grid),
            xlim = c(-4, 4),
            ylim = c(-0.2, 1),
            main = paste(length(samples), "samples"),
            xlab = "",
            ylab = "",
            col = "dark red",
            type = "l",
            lwd = 2
          )
        }
        lines(grid, kde$fun(grid), col = "orange")
      }
  }
}
```

```{r}
load(file="sim_objects.rda", envir=e)
```

##Dependency of Density Function

##Dependency of tuning Facor

##Dependency of Samples
